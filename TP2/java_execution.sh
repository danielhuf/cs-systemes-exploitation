#!/bin/bash

# Vérification que le répertoire est fourni
if [ $# -ne 1 ]
then
    echo "Nombre d'arguments incorrect"
    echo "Usage : $0 <répertoire>"
    exit 1
fi

source_dir="$1"
class_dir="$source_dir/bin"

# Vérification que le répertoire de destination existe
if [ ! -d "$class_dir" ]
then
    echo "Le répertoire $class_dir n'existe pas"
    exit 1
fi

# Parcours des fichiers .class dans le répertoire
cd "$class_dir"
for fichier_class in ./*.class
do
    # Récupération du nom du fichier sans l'extension .class
    nom_fichier=$(basename "$fichier_class" .class)

    # Vérification que le fichier .class contient une méthode de signature public static void main
    if javap -public "$nom_fichier" | grep -q "public static void main"
    then
        # Exécution du fichier .class
        echo "------------------------"
        echo "Exécution du fichier $nom_fichier"
        echo "------------------------"
        java "$nom_fichier"
    fi
done