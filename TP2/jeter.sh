#!/bin/bash

poubelle_dir="$HOME/poubelle"

# Vérification de l'existence de la poubelle
if [ ! -d "$poubelle_dir" ]
then
    mkdir -p "$poubelle_dir"

    # Vérification de la création de la poubelle
    if [ $? -eq 0 ]
    then
        echo "La poubelle a été créée avec succès !"
    else
        echo "Erreur lors de la création de la poubelle"
        exit 1
    fi
fi

# Fonction pour lister le contenu de la poubelle
function lister_poubelle {
    echo "Contenu de la poubelle :"
    echo "------------------------"
    ls -l "$poubelle_dir"
}

# Fonction pour sortir un fichier de la poubelle
function sortir_poubelle {
    # Vérification du nombre d'arguments
    if [ $# -ne 2 ]
    then
        echo "Nombre d'arguments incorrect"
        echo "Usage : $0 -s <fichier> <chemin>"
        exit 1
    fi

    # Vérification de l'existence du fichier
    if [ ! -f "$poubelle_dir/$1" ]
    then
        echo "Le fichier '$1' n'existe pas dans la poubelle"
        exit 1
    fi

    # Demande de confirmation
    echo "Voulez-vous vraiment sortir le fichier '$1' de la poubelle ? (y/n)"
    read reponse

    if [ $reponse = "y" ]
    then
        mv "$poubelle_dir/$1" "$2"
        if [ $? -eq 0 ]
        then
            echo "Le fichier '$1' a été sorti de la poubelle"
        else
            echo "Erreur lors de la sortie du fichier '$1' de la poubelle"
        fi
    else
        echo "Le fichier '$1' n'a pas été sorti de la poubelle"
    fi
}

# Fonction pour vider la poubelle
function vider_poubelle {
    # Demande de confirmation
    echo "Voulez-vous vraiment vider la poubelle ? (y/n)"
    read reponse

    if [ $reponse = "y" ]
    then
        rm -rf "$poubelle_dir"/*
        if [ $? -eq 0 ]
        then
            echo "La poubelle a été vidée"
        else
            echo "Erreur lors de la vidage de la poubelle"
        fi
    else
        echo "La poubelle n'a pas été vidée"
    fi
}

# Vérifier les options de la commande
case $1 in
    "-l") lister_poubelle;;
    "-s") sortir_poubelle "$2" "$3";;
    "-v") vider_poubelle;;
    *) 
    for fichier in "$@"
    do
        # Vérification de l'existence du fichier
        if [ -e "$fichier" ]
        then
            # Déplacement du fichier dans la poubelle
            mv "$fichier" "$poubelle_dir"
            if [ $? -eq 0 ]
            then
                echo "Le fichier '$fichier' a été déplacé dans la poubelle"
            else
                echo "Erreur lors du déplacement du fichier '$fichier' dans la poubelle"
            fi
        else
            echo "Le fichier '$fichier' n'existe pas"
        fi
    done
    ;;
esac